{"version":3,"sources":["/source/main.js"],"names":[],"mappings":"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","file":"main.min.js","sourcesContent":["/*!\n *\n *  Web Starter Kit\n *  Copyright 2015 Google Inc. All rights reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *    https://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License\n *\n */\n/* eslint-env browser */\n(function() {\n  'use strict';\n\n  // Your custom JavaScript goes here\n  const app = {};\n  let lastQueryLocation = new google.maps.LatLng({lat: 0, lng: 0});\n\n  /* CONSTANTS */\n  const GOOGLE_MAP_OPTIONS = {\n    zoom: 13,\n    center: new google.maps.LatLng(37.7703706, -122.3871226),\n    mapTypeId: google.maps.MapTypeId.ROADMAP,\n    mapTypeControl: false,\n    streetViewControl: false\n  };\n\n  // google map markers\n  const G_MARKER = {\n    path: 'M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z',\n    fillColor: '#607d8b',\n    fillOpacity: 0.7,\n    scale: 0.7,\n    strokeColor: '#607d8b',\n    strokeWeight: 3\n  };\n  const G_MARKER_SELECTED = {\n    path: 'M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z',\n    fillColor: '#009688',\n    fillOpacity: 0.8,\n    scale: 0.8,\n    strokeColor: '#009688',\n    strokeWeight: 3\n  };\n\n\n  /* CONTROLLER */\n  app.controller = {};\n\n  /* MODEL */\n  app.model = {\n    map: null,                      // google map object\n\n    places: ko.observableArray([]).extend({ rateLimit: 100 }), // main places storage\n    placesHash: new Map(),          // helps to search place from foursquare place id\n    markers: new WeakMap(),         // helps to search place from google marker\n    selectedPlaces: new Set(),      // places marked on the map todo not in use now\n\n    //Selected place\n    placeInFocus: ko.observable(),\n    isPlaceInFocusVisible: ko.observable(false),\n    hideDetailsModal: () => {app.model.isPlaceInFocusVisible(false)},\n\n    // error message\n    isFailureModalVisible: ko.observable(false),\n    hideFailureModal: () => {app.model.isFailureModelVisible(false)},\n\n    textFilter: ko.observable(''),\n\n    filteredPlaces: ko.pureComputed(() => {\n      let text = app.model.textFilter().trim().toLowerCase(),\n          places = app.model.places();\n      if (!text) return places;\n\n      return _.filter(places, place => place.name.toLowerCase().indexOf(text) !== -1 );\n    }),\n\n    isPlacesNotLoaded: ko.pureComputed(() => {\n      let places = app.model.places();\n      console.log('places', places.length);\n      return places.length === 0;\n    }),\n\n    // show spinner?\n    isLoading: ko.observable(false),\n\n    // click on a place in menu handler\n    onClickPlace: onClickPalace,\n\n    // click on a map marker handler\n    onClickMarker: onClickMarker,\n  };\n\n  /**\n   *  create a map, add map listener\n   */\n  app.controller.initApp = function initApp() {\n    // init google map\n\n    const map =  new google.maps.Map(document.getElementById('google-map'), GOOGLE_MAP_OPTIONS);\n    app.model.map = map;\n\n    // Try HTML5 geolocation\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(function(position) {\n        var pos = {\n          lat: position.coords.latitude,\n          lng: position.coords.longitude\n        };\n\n        map.setCenter(pos);\n      }, function() {\n        //handleLocationError\n      });\n    } else {\n      // Browser doesn't support Geolocation\n    }\n\n    map.addListener('bounds_changed', _.throttle(app.controller.loadPlaces, 3000));\n  };\n\n  /**\n   * load bars from 4square\n   */\n  app.controller.loadPlaces = function loadPlaces() {\n    const map = app.model.map;\n\n    // dont ask 4square on big areas\n    if (map.zoom < 16) return;\n\n    //distance between this point and last request\n    let distance = google.maps.geometry.spherical.computeDistanceBetween(lastQueryLocation, map.center);\n    // don't load new data if point is too close to previous search\n    if (distance < 1000) return;\n    lastQueryLocation = map.center;\n    app.model.isLoading(true);\n\n    // load data from foursquare\n    //TODO idea, calculate radius from map zoom\n    const lat = map.center.lat(),\n          lng = map.center.lng();\n    const FoursquareRequestOptions = {\n      ll: lat + ',' + lng,\n      radius: 2000,\n      section: 'drinks',\n      client_id: 'E54BQ11LCWJ15Q0FH4MELITI2CZQ5KSJOU53TNRARJ3HHNXN',\n      client_secret: 'T4O0ZURMG00IGUTU4NKSQZ4DH0E5LGLMDAE20OJWPXMBD10Y',\n      v: 20160909\n    };\n    $.get('https://api.foursquare.com/v2/venues/explore', FoursquareRequestOptions, app.controller.addPlaces)\n      .fail(function(){\n        app.model.isFailureModelVisible(true);\n      })\n      .always(function() {\n        app.model.isLoading(false);\n      });\n  };\n\n\n  /**\n   * add places to the map\n   * @param res - results from foursquare request\n   */\n  app.controller.addPlaces = function(res) {\n    //app.model.places.removeAll();\n\n    res.response.groups[0].items.forEach(function(item) {\n      if(app.model.placesHash.has(item.venue.id)) return; // don't allow to double items on the map\n\n      const place = new Place(item);\n      app.model.places.push(place);\n      app.model.placesHash.set(item.venue.id, place);\n      app.model.markers.set(place.marker, place);\n\n    });\n\n    // not more than 150 markers on the map\n    let length = app.model.places().length;\n    if (length > 150) app.controller.removePlacesFromStart(length - 150);\n\n    app.model.isLoading(false);\n  };\n\n  /**\n   * remove N places form the beginning of Array\n   * @param N\n     */\n  app.controller.removePlacesFromStart = function (N) {\n    let place;\n    for (let i = 0; i < N; i++) {\n      place = app.model.places.shift();\n      place.marker.setMap(null);\n      app.model.placesHash.delete(place.stash.venue.id);\n      if (app.model.placeInFocus() === place) app.model.placeInFocus(null);\n    }\n  };\n\n  /**\n   * map place\n   * @param item - one place from foursquare API response\n   * @constructor\n   */\n  function Place(item) {\n    const map = app.model.map;\n    const lat = item.venue.location.lat,\n          lng = item.venue.location.lng,\n          name = item.venue.name;\n\n    this.stash = item;\n    this.location = {lat, lng};\n    this.name = name;\n    this.isSelected = ko.observable(false);\n    this.marker = new google.maps.Marker({\n      map: map,\n      position: new google.maps.LatLng(lat, lng),\n      icon: G_MARKER,\n    });\n    this.marker.addListener('click', onClickMarker);\n  }\n\n  /**\n   * user clicks on a place in the menu\n   * @param place\n   */\n  function onClickPalace(place) {\n    if (app.model.selectedPlaces.has(place)) return;\n\n    // remove all selected\n    for (let selected of app.model.selectedPlaces) {\n      selected.isSelected(false);\n      selected.marker.setIcon(G_MARKER);\n      app.model.selectedPlaces.delete(selected);\n    }\n\n    //add place to selected\n    place.isSelected(true);\n    app.model.selectedPlaces.add(place);\n\n    // change marker icon and show place details modal window\n    place.marker.setIcon(G_MARKER_SELECTED);\n    app.model.placeInFocus(place);\n    app.model.isPlaceInFocusVisible(true);\n\n    app.model.map.panTo(place.location);\n\n    // hide side menu on small screens after click\n    if(window.matchMedia('(max-width: 426px)').matches) {\n      $('.mdl-layout__drawer').removeClass('is-visible');\n      $('.mdl-layout__obfuscator').removeClass('is-visible');\n    }\n  }\n\n  /**\n   * user clicks on a map marker\n   */\n  function onClickMarker() {\n    const place = app.model.markers.get(this);\n    onClickPalace(place);\n  }\n\n  // init app after loading page\n  $(function() {\n    ko.applyBindings(app.model);\n    app.controller.initApp();\n  });\n})();\n"],"sourceRoot":"/source/"}
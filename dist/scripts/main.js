"use strict";!function(){function e(){var e=new google.maps.Map(document.getElementById("google-map"),d);n.model.map=e,navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(o){var l={lat:o.coords.latitude,lng:o.coords.longitude};n.controller.removeAllPlaces(),e.setCenter(l)},function(){}),e.addListener("bounds_changed",_.throttle(n.controller.loadPlaces,2e3))}function o(){var e=n.model.map;if(n.viewModel.isZoomedOut(e.zoom<15),!(e.zoom<15)){var o=google.maps.geometry.spherical.computeDistanceBetween(c,e.center);if(!(o<1500)){c=e.center,n.viewModel.isLoading(!0);var l={ll:e.center.lat()+","+e.center.lng(),radius:2e3,section:"drinks",client_id:"E54BQ11LCWJ15Q0FH4MELITI2CZQ5KSJOU53TNRARJ3HHNXN",client_secret:"T4O0ZURMG00IGUTU4NKSQZ4DH0E5LGLMDAE20OJWPXMBD10Y",v:20160909};$.get("https://api.foursquare.com/v2/venues/explore",l,n.controller.addPlaces).fail(function(){n.viewModel.isFailureModalVisible(!0)}).always(function(){n.viewModel.isLoading(!1)})}}}function l(e){var o=n.model.map,l=e.venue.location.lat,a=e.venue.location.lng,i=e.venue.name;this.stash=e,this.location={lat:l,lng:a},this.name=i,this.isSelected=ko.observable(!1),this.marker=new google.maps.Marker({map:o,position:new google.maps.LatLng(l,a),icon:m}),this.marker.addListener("click",n.controller.onClickMarker)}function a(e){e.response.groups[0].items.forEach(function(e){if(!n.model.placesHash.has(e.venue.id)){var o=new l(e);n.model.places.push(o),n.model.placesHash.set(e.venue.id,o),n.model.markers.set(o.marker,o)}});var o=n.model.places().length;o>150&&n.controller.removePlacesFromStart(o-150),n.viewModel.isLoading(!1)}function i(e){for(var o=void 0,l=0;l<e;l++)o=n.model.places.shift(),o.marker.setMap(null),n.model.placesHash["delete"](o.stash.venue.id),n.viewModel.placeDetails()===o&&n.viewModel.placeDetails(null)}function t(){var e=n.model.places().length;n.controller.removePlacesFromStart(e)}function r(e){var o=n.viewModel.placeDetails();o!==e&&(o&&(o.isSelected(!1),o.marker.setIcon(m)),e.isSelected(!0),n.viewModel.placeDetails(e),n.viewModel.isPlaceDetailsVisible(!0),e.marker.setIcon(p),n.model.map.panTo(e.location),window.matchMedia("(max-width: 426px)").matches&&($(".mdl-layout__drawer").removeClass("is-visible"),$(".mdl-layout__obfuscator").removeClass("is-visible")))}function s(){var e=n.model.markers.get(this);n.controller.onClickPlace(e)}var n={},c=new google.maps.LatLng({lat:0,lng:0}),d={zoom:16,center:new google.maps.LatLng(37.7703706,(-122.3871226)),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1},m={path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:"#607d8b",fillOpacity:.7,scale:.7,strokeColor:"#607d8b",strokeWeight:3},p={path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:"#009688",fillOpacity:.8,scale:.8,strokeColor:"#009688",strokeWeight:3};n.controller={initApp:e,loadPlaces:o,onClickPlace:r,onClickMarker:s,addPlaces:a,removePlacesFromStart:i,removeAllPlaces:t},n.model={map:null,places:ko.observableArray([]).extend({rateLimit:100}),placesHash:new Map,markers:new WeakMap},n.viewModel={placeDetails:ko.observable(),isPlaceDetailsVisible:ko.observable(!1),hidePlaceDetails:function(){n.viewModel.isPlaceDetailsVisible(!1)},isFailureModalVisible:ko.observable(!1),hideFailureModal:function(){n.viewModel.isFailureModalVisible(!1)},textFilter:ko.observable(""),filteredPlaces:ko.pureComputed(function(){var e=n.viewModel.textFilter().trim().toLowerCase(),o=n.model.places();return e?_.filter(o,function(o){return o.name.toLowerCase().indexOf(e)!==-1}):o}),isPlacesNotLoaded:ko.pureComputed(function(){var e=n.model.places();return 0===e.length}),isLoading:ko.observable(!1),isZoomedOut:ko.observable(!1),onClickPlace:n.controller.onClickPlace},$(function(){ko.applyBindings(n.viewModel),n.controller.initApp()})}();
//# sourceMappingURL=main.js.map

"use strict";!function(){function e(){ko.applyBindings(c.viewModel),d=new google.maps.LatLng({lat:0,lng:0});var e={zoom:16,center:new google.maps.LatLng(37.7703706,(-122.3871226)),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1},o=new google.maps.Map(document.getElementById("google-map"),e);c.model.map=o,navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var l={lat:e.coords.latitude,lng:e.coords.longitude};c.controller.removeAllPlaces(),o.setCenter(l)},function(){}),o.addListener("bounds_changed",_.throttle(c.controller.loadPlaces,2e3))}function o(){var e=c.model.map;if(c.viewModel.isZoomedOut(e.zoom<15),!(e.zoom<15)){var o=google.maps.geometry.spherical.computeDistanceBetween(d,e.center);if(!(o<1500)){d=e.center,c.viewModel.isLoading(!0);var l={ll:e.center.lat()+","+e.center.lng(),radius:2e3,section:"drinks",client_id:"E54BQ11LCWJ15Q0FH4MELITI2CZQ5KSJOU53TNRARJ3HHNXN",client_secret:"T4O0ZURMG00IGUTU4NKSQZ4DH0E5LGLMDAE20OJWPXMBD10Y",v:20161025};$.get("https://api.foursquare.com/v2/venues/explore",l,c.controller.addPlaces).fail(function(){c.viewModel.isFailureModalVisible(!0)}).always(function(){c.viewModel.isLoading(!1)})}}}function l(e){var o=c.model.map,l=e.venue.location.lat,a=e.venue.location.lng,i=e.venue.name;this.stash=e,this.location={lat:l,lng:a},this.name=i,this.isSelected=ko.observable(!1),this.marker=new google.maps.Marker({map:o,position:new google.maps.LatLng(l,a),icon:m}),this.marker.addListener("click",c.controller.onClickMarker)}function a(e){e.response.groups[0].items.forEach(function(e){if(!c.model.placesHash.has(e.venue.id)){var o=new l(e);c.model.places.push(o),c.model.placesHash.set(e.venue.id,o),c.model.markers.set(o.marker,o)}});var o=c.model.places().length;o>150&&c.controller.removePlacesFromStart(o-150),c.viewModel.isLoading(!1)}function i(e){for(var o=void 0,l=0;l<e;l++)o=c.model.places.shift(),o.marker.setMap(null),c.model.placesHash["delete"](o.stash.venue.id),c.viewModel.placeDetails()===o&&c.viewModel.placeDetails(null)}function t(){var e=c.model.places().length;c.controller.removePlacesFromStart(e)}function r(){var e=c.model.markers.get(this);n(e)}function n(e){var o=c.viewModel.placeDetails();o!==e&&(o&&(o.isSelected(!1),o.marker.setIcon(m)),e.isSelected(!0),c.viewModel.placeDetails(e),c.viewModel.isPlaceDetailsVisible(!0),e.select(),c.model.map.panTo(e.location),window.matchMedia("(max-width: 426px)").matches&&($(".mdl-layout__drawer").removeClass("is-visible"),$(".mdl-layout__obfuscator").removeClass("is-visible")))}function s(e){var o=c.model.places();o.forEach(function(e){return e.marker.setMap(null)}),e.forEach(function(e){return e.marker.setMap(c.model.map)})}var c={},d=void 0,m={path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:"#607d8b",fillOpacity:.7,scale:.7,strokeColor:"#607d8b",strokeWeight:3},p={path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:"#009688",fillOpacity:.8,scale:.8,strokeColor:"#009688",strokeWeight:3};c.controller={initApp:e,loadPlaces:o,onClickPlace:n,onClickMarker:r,addPlaces:a,removePlacesFromStart:i,removeAllPlaces:t,googleError:function(){$("#failure-modal-google").addClass("is-visible")}},c.model={map:null,places:ko.observableArray([]).extend({rateLimit:100}),placesHash:new Map,markers:new WeakMap},c.viewModel={placeDetails:ko.observable(),isPlaceDetailsVisible:ko.observable(!1),hidePlaceDetails:function(){c.viewModel.isPlaceDetailsVisible(!1)},isFailureModalVisible:ko.observable(!1),hideFailureModal:function(){c.viewModel.isFailureModalVisible(!1)},textFilter:ko.observable(""),filteredPlaces:ko.pureComputed(function(){var e=void 0,o=c.viewModel.textFilter().trim().toLowerCase(),l=c.model.places();return e=o?l.filter(function(e){return e.name.toLowerCase().indexOf(o)!==-1}):l,s(e),e}),isPlacesNotLoaded:ko.pureComputed(function(){return!c.model.places().length}),isLoading:ko.observable(!1),isZoomedOut:ko.observable(!1),onClickPlace:c.controller.onClickPlace},l.prototype.select=function(){this.marker.setIcon(p)},window.initApp=c.controller.initApp,window.googleError=c.controller.googleError}();
//# sourceMappingURL=main.js.map

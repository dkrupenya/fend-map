"use strict";!function(){function e(){var e=new google.maps.Map(document.getElementById("google-map"),d);s.model.map=e,navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(l){var o={lat:l.coords.latitude,lng:l.coords.longitude};s.controller.removeAllPlaces(),e.setCenter(o)},function(){}),e.addListener("bounds_changed",_.throttle(s.controller.loadPlaces,2e3))}function l(){var e=s.model.map;if(!(e.zoom<15)){var l=google.maps.geometry.spherical.computeDistanceBetween(c,e.center);if(!(l<1500)){c=e.center,s.viewModel.isLoading(!0);var o={ll:e.center.lat()+","+e.center.lng(),radius:2e3,section:"drinks",client_id:"E54BQ11LCWJ15Q0FH4MELITI2CZQ5KSJOU53TNRARJ3HHNXN",client_secret:"T4O0ZURMG00IGUTU4NKSQZ4DH0E5LGLMDAE20OJWPXMBD10Y",v:20160909};$.get("https://api.foursquare.com/v2/venues/explore",o,s.controller.addPlaces).fail(function(){s.viewModel.isFailureModalVisible(!0)}).always(function(){s.viewModel.isLoading(!1)})}}}function o(e){var l=s.model.map,o=e.venue.location.lat,a=e.venue.location.lng,i=e.venue.name;this.stash=e,this.location={lat:o,lng:a},this.name=i,this.isSelected=ko.observable(!1),this.marker=new google.maps.Marker({map:l,position:new google.maps.LatLng(o,a),icon:m}),this.marker.addListener("click",s.controller.onClickMarker)}function a(e){e.response.groups[0].items.forEach(function(e){if(!s.model.placesHash.has(e.venue.id)){var l=new o(e);s.model.places.push(l),s.model.placesHash.set(e.venue.id,l),s.model.markers.set(l.marker,l)}});var l=s.model.places().length;l>150&&s.controller.removePlacesFromStart(l-150),s.viewModel.isLoading(!1)}function i(e){for(var l=void 0,o=0;o<e;o++)l=s.model.places.shift(),l.marker.setMap(null),s.model.placesHash["delete"](l.stash.venue.id),s.viewModel.placeDetails()===l&&s.viewModel.placeDetails(null)}function t(){var e=s.model.places().length;s.controller.removePlacesFromStart(e)}function r(e){var l=s.viewModel.placeDetails();l!==e&&(l&&(l.isSelected(!1),l.marker.setIcon(m)),e.isSelected(!0),s.viewModel.placeDetails(e),s.viewModel.isPlaceDetailsVisible(!0),e.marker.setIcon(p),s.model.map.panTo(e.location),window.matchMedia("(max-width: 426px)").matches&&($(".mdl-layout__drawer").removeClass("is-visible"),$(".mdl-layout__obfuscator").removeClass("is-visible")))}function n(){var e=s.model.markers.get(this);s.controller.onClickPlace(e)}var s={},c=new google.maps.LatLng({lat:0,lng:0}),d={zoom:16,center:new google.maps.LatLng(37.7703706,(-122.3871226)),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1},m={path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:"#607d8b",fillOpacity:.7,scale:.7,strokeColor:"#607d8b",strokeWeight:3},p={path:"M0-48c-9.8 0-17.7 7.8-17.7 17.4 0 15.5 17.7 30.6 17.7 30.6s17.7-15.4 17.7-30.6c0-9.6-7.9-17.4-17.7-17.4z",fillColor:"#009688",fillOpacity:.8,scale:.8,strokeColor:"#009688",strokeWeight:3};s.controller={initApp:e,loadPlaces:l,onClickPlace:r,onClickMarker:n,addPlaces:a,removePlacesFromStart:i,removeAllPlaces:t},s.model={map:null,places:ko.observableArray([]).extend({rateLimit:100}),placesHash:new Map,markers:new WeakMap},s.viewModel={placeDetails:ko.observable(),isPlaceDetailsVisible:ko.observable(!1),hidePlaceDetails:function(){s.viewModel.isPlaceDetailsVisible(!1)},isFailureModalVisible:ko.observable(!1),hideFailureModal:function(){s.viewModel.isFailureModalVisible(!1)},textFilter:ko.observable(""),filteredPlaces:ko.pureComputed(function(){var e=s.viewModel.textFilter().trim().toLowerCase(),l=s.model.places();return e?_.filter(l,function(l){return l.name.toLowerCase().indexOf(e)!==-1}):l}),isPlacesNotLoaded:ko.pureComputed(function(){var e=s.model.places();return 0===e.length}),isLoading:ko.observable(!1),onClickPlace:s.controller.onClickPlace},$(function(){ko.applyBindings(s.viewModel),s.controller.initApp()})}();
//# sourceMappingURL=main.js.map
